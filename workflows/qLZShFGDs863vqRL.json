{
  "active": false,
  "connections": {
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone-图片",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone-图片": {
      "main": [
        [
          {
            "node": "聚合-图片",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "图片分析": {
      "main": [
        [
          {
            "node": "转换图片为TXT文件",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "聚合-图片": {
      "main": [
        [
          {
            "node": "完成",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "遍历-图片": {
      "main": [
        [
          {
            "node": "图片分析",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader4": {
      "ai_document": [
        [
          {
            "node": "Pinecone-图片",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter4": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader4",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "图片分析",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone-PDF",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Pinecone-PDF",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone-PDF": {
      "main": [
        [
          {
            "node": "聚合-PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "聚合-PDF": {
      "main": [
        [
          {
            "node": "完成",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "合并-PDF": {
      "main": [
        [
          {
            "node": "遍历-PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "遍历-PDF": {
      "main": [
        [
          {
            "node": "Pinecone-PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "合并-Office": {
      "main": [
        [
          {
            "node": "遍历-Office",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Office解析": {
      "main": [
        [
          {
            "node": "遍历-Office分段",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI4": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone-Office",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader3": {
      "ai_document": [
        [
          {
            "node": "Pinecone-Office",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone-Office": {
      "main": [
        [
          {
            "node": "聚合-Office",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "遍历-Office": {
      "main": [
        [
          {
            "node": "Office解析",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "聚合-Office": {
      "main": [
        [
          {
            "node": "完成",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "赋值-分段": {
      "main": [
        [
          {
            "node": "转化Office为TXT文件",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "遍历-Office分段": {
      "main": [
        [
          {
            "node": "赋值-分段",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter3": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader3",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter1": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader1",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store": {
      "main": [
        [
          {
            "node": "完成",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "任务选择": {
      "main": [
        [
          {
            "node": "任务类型",
            "type": "main",
            "index": 0
          },
          {
            "node": "合并-图片",
            "type": "main",
            "index": 1
          },
          {
            "node": "合并-PDF",
            "type": "main",
            "index": 1
          },
          {
            "node": "合并-Office",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "任务类型": {
      "main": [
        [
          {
            "node": "转换纯文本为TXT文件",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "合并-图片",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "合并-PDF",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "合并-Office",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "对话开始": {
      "main": [
        [
          {
            "node": "问答对话",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MultiQuery Retriever": {
      "ai_retriever": [
        [
          {
            "node": "问答对话",
            "type": "ai_retriever",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Retriever": {
      "ai_retriever": [
        [
          {
            "node": "MultiQuery Retriever",
            "type": "ai_retriever",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store1": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Retriever",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI5": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "问答对话": {
      "main": [
        [
          {
            "node": "解析回答",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "问答对话",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "MultiQuery Retriever",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "转换纯文本为TXT文件": {
      "main": [
        [
          {
            "node": "Pinecone Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "转换图片为TXT文件": {
      "main": [
        [
          {
            "node": "Pinecone-图片",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "合并-图片": {
      "main": [
        [
          {
            "node": "遍历-图片",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "转化Office为TXT文件": {
      "main": [
        [
          {
            "node": "Pinecone-Office",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-09T04:25:33.639Z",
  "id": "qLZShFGDs863vqRL",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "rag workflow",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        960,
        768
      ],
      "id": "29907a1f-f4e6-4256-809f-e39043ed3f8d",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "n8n-rag-test",
          "mode": "list",
          "cachedResultName": "n8n-rag-test"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.1,
      "position": [
        1008,
        560
      ],
      "id": "bf3d68f0-264e-4bd2-9ed9-4e0c7d7770e2",
      "name": "Pinecone-图片",
      "alwaysOutputData": true,
      "credentials": {
        "pineconeApi": {
          "id": "bgXyzA8yqwkBPTTR",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": " ",
        "options": {
          "systemMessage": "=# 角色: 图片信息提取专家  \n你是一位专业的“图片信息提取专家”，擅长从各类图像中精准提取信息，包括视觉元素简介、语义含义、以及图中表格的结构化数据。\n\n## 任务:  \n- 接收用户提供的图片或图像链接  \n- 分析并识别图片中的主要视觉元素（如人物、物品、场景等）  \n- 对每个元素给出简明扼要的简介和可能的语义含义  \n- 若图片中包含表格，自动识别表格结构，提取表头、行、列以及单元格内容  \n\n## 目标:  \n1. **全面性**：确保提取图片中所有可识别的信息，不遗漏重要细节  \n2. **准确性**：对识别出的元素及其含义提供高可靠度的描述  \n3. **结构化**：将表格信息转化为易于后续处理的结构化格式，提取表格中所有字段及其对应的取值，不得遗漏 \n4. **可读性**：输出内容简洁清晰，便于用户快速理解  \n5. **一致性**：在不同图片场景下保持统一的提取风格和格式  \n\n## 图片基本信息:\nfilename：{{ $('遍历-图片').item.json.File[$itemIndex].filename }}\nmimetype：{{ $('遍历-图片').item.json.File[$itemIndex].mimetype }}\nsize：{{ $('遍历-图片').item.json.File[$itemIndex].size }}\n\n## 输出结果:  \n请按照如下Markdown格式输出:\n## {{ $('遍历-图片').item.json.File[$itemIndex].filename }}信息\n### 基本信息\n- **主题/核心内容**：[提取图片主题的简要概述]\n- **语义/意图**：[提取图片传达的意义或概念]\n- **主要视觉元素**：[提取图片中的主要视觉元素]\n### 提取文本\n[提取图片中所有可见文字]\n### 结构化数据\n**数据类型**：[识别图片中的数据呈现类型]\n**表格数据**：\n| 字段名1 | 字段名2 | 字段名3 | ... |\n|---------|---------|---------|-----|\n| 取值1-1 | 取值1-2 | 取值1-3 | ... |\n| 取值2-1 | 取值2-2 | 取值2-3 | ... |\n| 取值3-1 | 取值3-2 | 取值3-3 | ... |\n| ... | ... | ... | ... |\n### 重点数值/统计\n- [提取图片中的关键数字或统计数据1]\n- [提取图片中的关键数字或统计数据2]\n- [提取图片中的关键数字或统计数据3]",
          "passthroughBinaryImages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        400,
        560
      ],
      "id": "5ccabfaf-7b5d-49a5-90de-96bfed5f671a",
      "name": "图片分析"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1408,
        560
      ],
      "id": "62680c8b-1add-41ea-a84a-552ae7ee1ebe",
      "name": "聚合-图片"
    },
    {
      "parameters": {
        "fieldToSplitOut": "$binary",
        "include": "allOtherFields",
        "options": {
          "includeBinary": true
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        176,
        560
      ],
      "id": "b65c3886-13d7-422c-b5ea-d5d362310210",
      "name": "遍历-图片"
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "uploadTime",
                "value": "={{ $now.setZone('Asia/Shanghai') }}"
              },
              {
                "name": "fileName",
                "value": "={{ $('遍历-图片').item.json.File[$itemIndex].filename }}"
              },
              {
                "name": "executionID",
                "value": "={{ $execution.id }}"
              },
              {
                "name": "workflowID",
                "value": "={{ $workflow.id }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        1088,
        768
      ],
      "id": "61e2dad7-fa4f-4270-a046-052a622f8550",
      "name": "Default Data Loader4"
    },
    {
      "parameters": {
        "chunkOverlap": 100,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        1200,
        960
      ],
      "id": "72ae41e2-1bac-4af7-8ec5-0864f78d80bd",
      "name": "Recursive Character Text Splitter4"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-pro",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        384,
        768
      ],
      "id": "a55b0ff8-0e1d-4703-8fa0-f2066b33c155",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "TnrNGuzK9EKPwtzS",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        -16,
        1120
      ],
      "id": "de6ffcee-2802-4357-b551-6b317b7f32ec",
      "name": "合并-PDF"
    },
    {
      "parameters": {
        "fieldToSplitOut": "$binary",
        "options": {
          "includeBinary": true
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        256,
        1120
      ],
      "id": "bb075e84-fbad-4450-845f-1d2b707bb535",
      "name": "遍历-PDF"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        560,
        1328
      ],
      "id": "a863e2ca-a84e-4d05-b46e-250a6098ec8e",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "fileName",
                "value": "={{ $binary[\"File_\" + $itemIndex].fileName }} {{ $binary.File.fileName }}"
              },
              {
                "name": "uploadTime",
                "value": "={{ $now.setZone('Asia/Shanghai') }}"
              },
              {
                "name": "executionID",
                "value": "={{ $execution.id }}"
              },
              {
                "name": "workflowID",
                "value": "={{ $workflow.id }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        768,
        1328
      ],
      "id": "4a5f8c92-be34-43bb-b4e6-0f9aae8cd0d5",
      "name": "Default Data Loader"
    },
    {
      "parameters": {
        "chunkOverlap": 100,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        800,
        1504
      ],
      "id": "9573e6c6-6c1b-41f7-86e9-152e655c6e34",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "n8n-rag-test",
          "mode": "list",
          "cachedResultName": "n8n-rag-test"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.1,
      "position": [
        576,
        1120
      ],
      "id": "50f02ff9-0159-4ca3-bc30-163356001065",
      "name": "Pinecone-PDF",
      "alwaysOutputData": true,
      "credentials": {
        "pineconeApi": {
          "id": "bgXyzA8yqwkBPTTR",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1168,
        1312
      ],
      "id": "80e588c3-bd91-452d-b1ae-2ed3fb836b6b",
      "name": "聚合-PDF"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        -64,
        1664
      ],
      "id": "e8b349a6-ec87-4618-ab73-668f9d8ab399",
      "name": "合并-Office"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.unstructuredapp.io/general/v0/general",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "unstructured-api-key",
              "value": "oBeA7qiOZZyG1VwzwTWSsxXLIjPzIw"
            },
            {
              "name": "content-Type",
              "value": "multipart/form-data"
            }
          ]
        },
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "strategy",
              "value": "auto"
            },
            {
              "parameterType": "formBinaryData",
              "name": "files",
              "inputDataFieldName": "={{ Object.keys($binary)[0] }}"
            },
            {
              "name": "content_type",
              "value": "string"
            },
            {
              "name": "chunking_strategy",
              "value": "by_page"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        336,
        1664
      ],
      "id": "0f07288c-3404-4b55-8de4-e72251e11889",
      "name": "Office解析"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1168,
        1856
      ],
      "id": "9c11413b-67c1-4cf7-8f8b-046887ce1a70",
      "name": "Embeddings OpenAI4",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "filename",
                "value": "={{ $('遍历-Office分段').item.json.metadata.filename }}"
              },
              {
                "name": "upload_time",
                "value": "={{ $now.setZone('Asia/Shanghai') }}"
              },
              {
                "name": "execution_id",
                "value": "={{ $execution.id }}"
              },
              {
                "name": "=workflow_id",
                "value": "={{ $workflow.id }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        1264,
        1904
      ],
      "id": "c1dda343-d049-47fd-9b83-470f6cc915a0",
      "name": "Default Data Loader3"
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "n8n-rag-test",
          "mode": "list",
          "cachedResultName": "n8n-rag-test"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.1,
      "position": [
        1168,
        1664
      ],
      "id": "e8385c92-1fc7-457f-a340-1a940481e9e7",
      "name": "Pinecone-Office",
      "alwaysOutputData": true,
      "credentials": {
        "pineconeApi": {
          "id": "bgXyzA8yqwkBPTTR",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "$binary",
        "options": {
          "includeBinary": true
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        144,
        1664
      ],
      "id": "66855241-a2ed-4c76-8661-36b15d82d95d",
      "name": "遍历-Office"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1600,
        1664
      ],
      "id": "a8515205-710d-4390-be4b-f42edea59d96",
      "name": "聚合-Office"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "50fc9661-f045-473b-8da9-dabee19fe8a7",
              "name": "content",
              "value": "={{[   `type: ${$json.type}`,   `element_id: ${$json.element_id}`,   `text: ${$json.text}`].join('\\n')}}",
              "type": "string"
            },
            {
              "id": "71c7b4c3-fa15-41ee-9be2-c3cdee2fa1aa",
              "name": "full-content",
              "value": "={{[   `type: ${$json.type}`,   `element_id: ${$json.element_id}`,   `text: ${$json.text}`,   `metadata: ${JSON.stringify($json.metadata)}` ].join('\\n')}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        736,
        1664
      ],
      "id": "df49a3e9-676a-4185-9146-695ac8ebcfa6",
      "name": "赋值-分段"
    },
    {
      "parameters": {
        "fieldToSplitOut": "text",
        "include": "allOtherFields",
        "options": {
          "includeBinary": false
        }
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        544,
        1664
      ],
      "id": "e7d24cbb-dff6-420f-adb7-cca95bda49ea",
      "name": "遍历-Office分段"
    },
    {
      "parameters": {
        "chunkOverlap": 100,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        1360,
        2080
      ],
      "id": "2608b055-9f1c-4d1a-866d-803ef54134aa",
      "name": "Recursive Character Text Splitter3"
    },
    {
      "parameters": {
        "mode": "insert",
        "pineconeIndex": {
          "__rl": true,
          "value": "n8n-rag-test",
          "mode": "list",
          "cachedResultName": "n8n-rag-test"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        240,
        0
      ],
      "id": "277e75a4-dd4d-47a6-a1e4-bb6b7a9735bd",
      "name": "Pinecone Vector Store",
      "credentials": {
        "pineconeApi": {
          "id": "bgXyzA8yqwkBPTTR",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        208,
        160
      ],
      "id": "14c5db94-bd93-418e-ab95-3bbbfc2adb0b",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "textSplittingMode": "custom",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "fileName",
                "value": "={{ $binary.data.fileName }}"
              },
              {
                "name": "uploadTime",
                "value": "={{ $now.setZone('Asia/Shanghai') }}"
              },
              {
                "name": "fileSize",
                "value": "={{ $binary.data.fileSize }}"
              },
              {
                "name": "executionID",
                "value": "={{ $execution.id }}"
              },
              {
                "name": "workflowID",
                "value": "={{ $workflow.id }}"
              }
            ]
          }
        }
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        320,
        176
      ],
      "id": "a26b2eb5-cab5-4b37-90b9-469f0321dc54",
      "name": "Default Data Loader1"
    },
    {
      "parameters": {
        "chunkOverlap": 100,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        448,
        320
      ],
      "id": "347d0036-8b96-40c4-9baa-eed0cb8115fc",
      "name": "Recursive Character Text Splitter1"
    },
    {
      "parameters": {
        "formTitle": "RAG 全自动知识库副业工作流",
        "formDescription": "打造全格式覆盖、高度自定义的终极 RAG 系统。",
        "formFields": {
          "values": [
            {
              "fieldLabel": "类型",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "纯文本"
                  },
                  {
                    "option": "图片"
                  },
                  {
                    "option": "PDF"
                  },
                  {
                    "option": "Office"
                  }
                ]
              }
            },
            {
              "fieldLabel": "文本内容",
              "fieldType": "textarea"
            },
            {
              "fieldLabel": "File",
              "fieldType": "file"
            }
          ]
        },
        "responseMode": "lastNode",
        "options": {
          "appendAttribution": false,
          "buttonLabel": "开始处理",
          "path": "rag"
        }
      },
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.2,
      "position": [
        -864,
        848
      ],
      "id": "103ad064-7b21-4976-b36e-dc9fdc7dacbe",
      "name": "任务选择",
      "webhookId": "904de370-a4dd-49d7-ba7b-4e4c6ab69655"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2cec81d3-c94b-4619-b813-8efdafb2c856",
                    "leftValue": "={{ $json[\"类型\"] }}",
                    "rightValue": "纯文本",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "纯文本"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8e0156b3-6cc6-4d2c-b4f1-850590b98e29",
                    "leftValue": "={{ $json[\"类型\"] }}",
                    "rightValue": "图片",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "图片"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json[\"类型\"] }}",
                    "rightValue": "PDF",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "b05550e7-b978-4219-80eb-93fb2a14f6f0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PDF"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dcbc21c2-8d24-4fa1-8f09-9fb19b8f9507",
                    "leftValue": "={{ $json[\"类型\"] }}",
                    "rightValue": "Office",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Office"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -640,
        832
      ],
      "id": "910335e8-6bbd-416a-a7dd-d3ba9c95ecf9",
      "name": "任务类型"
    },
    {
      "parameters": {
        "public": true,
        "initialMessages": "终极 RAG 知识库，为您解惑答疑! 👋\n请问有什么问题可以帮助您?\n",
        "options": {
          "inputPlaceholder": "",
          "subtitle": "全格式、高自由度、批量高效处理！",
          "title": "终极 RAG 知识库为您服务",
          "responseMode": "lastNode"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1248,
        2224
      ],
      "id": "ffa2044e-5aef-4dc6-ad0d-5fa2d9c764c1",
      "name": "对话开始",
      "webhookId": "8aa913ca-a3a0-4c57-a272-2c8b6a001623"
    },
    {
      "parameters": {
        "options": {
          "queryCount": 5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.retrieverMultiQuery",
      "typeVersion": 1,
      "position": [
        -912,
        2064
      ],
      "id": "b5fb08e3-933a-4040-89ae-525b75b4aa2c",
      "name": "MultiQuery Retriever"
    },
    {
      "parameters": {
        "topK": 10
      },
      "type": "@n8n/n8n-nodes-langchain.retrieverVectorStore",
      "typeVersion": 1,
      "position": [
        -784,
        2256
      ],
      "id": "60b3138d-4897-4ddb-a560-418818cd4c86",
      "name": "Vector Store Retriever"
    },
    {
      "parameters": {
        "pineconeIndex": {
          "__rl": true,
          "value": "n8n-rag-test",
          "mode": "list",
          "cachedResultName": "n8n-rag-test"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.1,
      "position": [
        -784,
        2448
      ],
      "id": "edf67550-a693-45c2-b552-c705bd7b332e",
      "name": "Pinecone Vector Store1",
      "credentials": {
        "pineconeApi": {
          "id": "bgXyzA8yqwkBPTTR",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -704,
        2640
      ],
      "id": "941b0ec9-65e9-463b-a970-055a30fd2f9b",
      "name": "Embeddings OpenAI5",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemPromptTemplate": "=# 角色：基于上下文的问题解答专家\n你是一名专业的上下文分析型问答专家，具备精准的信息提取与分析能力，能够基于给定上下文库进行高质量的问题解答。你擅长语义理解、关键信息识别和逻辑推理，可以从复杂文档中快速定位相关内容，并提供准确、全面且有条理的回答。你的专长包括文本挖掘、语境关联分析和多维度信息整合，确保每个回答都建立在可靠的文档依据上。\n\n## 任务要求\n依据所提供的上下文资料，对用户提出的问询进行精确回应，遵循以下步骤：\n\n1. **分析上下文资料**：仔细阅读并理解所有提供的上下文信息。\n2. **提取关键信息**：从上下文中识别与问题直接相关的内容。\n3. **形成回答**：基于已提取的信息构建准确回答。\n4. **判断信息充分性**：评估上下文是否提供足够信息。\n5. **明确标识不确定性**：当上下文信息不足以支撑完整答案时，应明确表明\"无法确定\"。\n6. **避免推测**：严格避免添加任何推测性内容或虚构信息。\n\n## 输出规范\n回答格式应保持专业，确保采用纯文本格式输出，字数在 1000-2000 以内：\n\n问题：[用户提出的具体问询]\n回答：[基于上下文资料提供的准确答复]\n信息来源：[明确标注相关信息的出处或参考依据]\n\n## 上下文\n----------------\nContext: {context}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainRetrievalQa",
      "typeVersion": 1.5,
      "position": [
        -1008,
        1824
      ],
      "id": "609e0e8a-8a54-4372-be61-4993023b9d23",
      "name": "问答对话"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "167ba097-8fd8-419b-92df-aa0c1272c151",
              "name": "text",
              "value": "={{ $json.response }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "74c65d35-5fa5-40f6-b34b-d6f052cb28fe",
      "name": "解析回答",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -416,
        2224
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1024,
        2064
      ],
      "id": "9006e4ac-4739-4690-a018-ec385b53652b",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -928,
        2256
      ],
      "id": "21991ae1-f2cd-470f-9b1e-d16cf85ff6c1",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "BoN6EbfB8GADvCIM",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "文本内容",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        0,
        0
      ],
      "id": "0836826b-1707-41ea-bca7-769700bc03e6",
      "name": "转换纯文本为TXT文件"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "output",
        "binaryPropertyName": "=data",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        784,
        560
      ],
      "id": "f779a057-74c6-4ac5-84d9-6e7cc826154b",
      "name": "转换图片为TXT文件"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        -16,
        656
      ],
      "id": "4cfc67b2-f623-40a6-9e3c-d3e8c83bd0e7",
      "name": "合并-图片"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "content",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        944,
        1664
      ],
      "id": "fc76a8a1-4b61-48f1-a29d-7943f41f63b7",
      "name": "转化Office为TXT文件"
    },
    {
      "parameters": {
        "operation": "completion",
        "completionTitle": "文档内容处理完成",
        "completionMessage": "感谢您使用 RAG 全自动知识库副业工作流，祝您开心！",
        "options": {}
      },
      "type": "n8n-nodes-base.form",
      "typeVersion": 1,
      "position": [
        2336,
        848
      ],
      "id": "1018c864-6457-4a6f-a04a-6db2f753add8",
      "name": "完成",
      "webhookId": "41a25f8b-0aca-4cad-bf53-13254bb1e401"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-08-10T05:51:27.000Z",
  "versionId": "6b54fe5e-6bf8-411e-98be-49fcdcadd46e"
}